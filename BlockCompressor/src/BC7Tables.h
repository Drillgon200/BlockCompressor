#pragma once

#include <stdint.h>

#pragma pack(push, 1)
struct alignas(16) BC7PartitionTable {
	uint8_t partitionNumbers[16];
};
#pragma pack(pop)

#define NUM_BC7_MODES 8

constexpr uint32_t bc7NumSubsets[NUM_BC7_MODES]{ 3, 2, 3, 2, 1, 1, 1, 2 };
constexpr uint32_t bc7PartitionBitCounts[NUM_BC7_MODES]{ 4, 6, 6, 6, 0, 0, 0, 6 };
constexpr uint32_t bc7RotationBitCounts[NUM_BC7_MODES]{ 0, 0, 0, 0, 2, 2, 0, 0 };
constexpr uint32_t bc7IndexSelectionBit[NUM_BC7_MODES]{ 0, 0, 0, 0, 1, 0, 0, 0 };
constexpr uint32_t bc7ColorBits[NUM_BC7_MODES]{ 4, 6, 5, 7, 5, 7, 7, 5 };
constexpr uint32_t bc7AlphaBits[NUM_BC7_MODES]{ 0, 0, 0, 0, 6, 8, 7, 5 };
constexpr uint32_t bc7EndpointPBits[NUM_BC7_MODES]{ 1, 0, 0, 1, 0, 0, 1, 1 };
constexpr uint32_t bc7SharedPBits[NUM_BC7_MODES]{ 0, 1, 0, 0, 0, 0, 0, 0 };
constexpr uint32_t bc7IndexBits[NUM_BC7_MODES]{ 3, 3, 2, 2, 2, 2, 4, 2 };
constexpr uint32_t bc7SecondaryIndexBits[NUM_BC7_MODES]{ 0, 0, 0, 0, 3, 2, 0, 0 };

constexpr uint32_t bc7InterpolationFactors2[4]{ 0, 21, 43, 64 };
constexpr uint32_t bc7InterpolationFactors3[8]{ 0, 9, 18, 27, 37, 46, 55, 64 };
constexpr uint32_t bc7InterpolationFactors4[16]{ 0, 4, 9, 13, 17, 21, 26, 30, 34, 38, 43, 47, 51, 55, 60, 64 };

alignas(32) const uint32_t bc7PartitionTable2Anchors2ndSubset[64]{ 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 2, 8, 2, 2, 8, 8, 15, 2, 8, 2, 2, 8, 8, 2, 2, 15, 15, 6, 8, 2, 8, 15, 15, 2, 8, 2, 2, 2, 15, 15, 6, 6, 2, 6, 8, 15, 15, 2, 2, 15, 15, 15, 15, 15, 2, 2, 15 };
alignas(32) const uint32_t bc7PartitionTable3Anchors2ndSubset[64]{ 3, 3, 15, 15, 8, 3, 15, 15, 8, 8, 6, 6, 6, 5, 3, 3, 3, 3, 8, 15, 3, 3, 6, 10, 5, 8, 8, 6, 8, 5, 15, 15, 8, 15, 3, 5, 6, 10, 8, 15, 15, 3, 15, 5, 15, 15, 15, 15, 3, 15, 5, 5, 5, 8, 5, 10, 5, 10, 8, 13, 15, 12, 3, 3 };
alignas(32) const uint32_t bc7PartitionTable3Anchors3rdSubset[64]{ 15, 8, 8, 3, 15, 15, 3, 8, 15, 15, 15, 15, 15, 15, 15, 8, 15, 8, 15, 3, 15, 8, 15, 8, 3, 15, 6, 10, 15, 15, 10, 8, 15, 3, 15, 10, 10, 8, 9, 10, 6, 15, 8, 15, 3, 6, 6, 8, 15, 3, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 3, 15, 15, 8 };

const BC7PartitionTable bc7DummyPartitionTableAllZeros{
0, 0, 0, 0,
0, 0, 0, 0,
0, 0, 0, 0,
0, 0, 0, 0
};

const BC7PartitionTable bc7PartitionTable2Subsets[64]{
{ //0
0, 0, 1, 1,
0, 0, 1, 1,
0, 0, 1, 1,
0, 0, 1, 1
},
{ //1
0, 0, 0, 1,
0, 0, 0, 1,
0, 0, 0, 1,
0, 0, 0, 1
},
{ //2
0, 1, 1, 1,
0, 1, 1, 1,
0, 1, 1, 1,
0, 1, 1, 1
},
{ //3
0, 0, 0, 1,
0, 0, 1, 1,
0, 0, 1, 1,
0, 1, 1, 1
},
{ //4
0, 0, 0, 0,
0, 0, 0, 1,
0, 0, 0, 1,
0, 0, 1, 1
},
{ //5
0, 0, 1, 1,
0, 1, 1, 1,
0, 1, 1, 1,
1, 1, 1, 1
},
{ //6
0, 0, 0, 1,
0, 0, 1, 1,
0, 1, 1, 1,
1, 1, 1, 1
},
{ //7
0, 0, 0, 0,
0, 0, 0, 1,
0, 0, 1, 1,
0, 1, 1, 1
},
{ //8
0, 0, 0, 0,
0, 0, 0, 0,
0, 0, 0, 1,
0, 0, 1, 1
},
{ //9
0, 0, 1, 1,
0, 1, 1, 1,
1, 1, 1, 1,
1, 1, 1, 1
},
{ //10
0, 0, 0, 0,
0, 0, 0, 1,
0, 1, 1, 1,
1, 1, 1, 1
},
{ //11
0, 0, 0, 0,
0, 0, 0, 0,
0, 0, 0, 1,
0, 1, 1, 1
},
{ //12
0, 0, 0, 1,
0, 1, 1, 1,
1, 1, 1, 1,
1, 1, 1, 1
},
{ //13
0, 0, 0, 0,
0, 0, 0, 0,
1, 1, 1, 1,
1, 1, 1, 1
},
{ //14
0, 0, 0, 0,
1, 1, 1, 1,
1, 1, 1, 1,
1, 1, 1, 1
},
{ //15
0, 0, 0, 0,
0, 0, 0, 0,
0, 0, 0, 0,
1, 1, 1, 1
},
{ //16
0, 0, 0, 0,
1, 0, 0, 0,
1, 1, 1, 0,
1, 1, 1, 1
},
{ //17
0, 1, 1, 1,
0, 0, 0, 1,
0, 0, 0, 0,
0, 0, 0, 0
},
{ //18
0, 0, 0, 0,
0, 0, 0, 0,
1, 0, 0, 0,
1, 1, 1, 0
},
{ //19
0, 1, 1, 1,
0, 0, 1, 1,
0, 0, 0, 1,
0, 0, 0, 0
},
{ //20
0, 0, 1, 1,
0, 0, 0, 1,
0, 0, 0, 0,
0, 0, 0, 0
},
{ //21
0, 0, 0, 0,
1, 0, 0, 0,
1, 1, 0, 0,
1, 1, 1, 0
},
{ //22
0, 0, 0, 0,
0, 0, 0, 0,
1, 0, 0, 0,
1, 1, 0, 0
},
{ //23
0, 1, 1, 1,
0, 0, 1, 1,
0, 0, 1, 1,
0, 0, 0, 1
},
{ //24
0, 0, 1, 1,
0, 0, 0, 1,
0, 0, 0, 1,
0, 0, 0, 0
},
{ //25
0, 0, 0, 0,
1, 0, 0, 0,
1, 0, 0, 0,
1, 1, 0, 0
},
{ //26
0, 1, 1, 0,
0, 1, 1, 0,
0, 1, 1, 0,
0, 1, 1, 0
},
{ //27
0, 0, 1, 1,
0, 1, 1, 0,
0, 1, 1, 0,
1, 1, 0, 0
},
{ //28
0, 0, 0, 1,
0, 1, 1, 1,
1, 1, 1, 0,
1, 0, 0, 0
},
{ //29
0, 0, 0, 0,
1, 1, 1, 1,
1, 1, 1, 1,
0, 0, 0, 0
},
{ //30
0, 1, 1, 1,
0, 0, 0, 1,
1, 0, 0, 0,
1, 1, 1, 0
},
{ //31
0, 0, 1, 1,
1, 0, 0, 1,
1, 0, 0, 1,
1, 1, 0, 0
},
{ //32
0, 1, 0, 1,
0, 1, 0, 1,
0, 1, 0, 1,
0, 1, 0, 1
},
{ //33
0, 0, 0, 0,
1, 1, 1, 1,
0, 0, 0, 0,
1, 1, 1, 1
},
{ //34
0, 1, 0, 1,
1, 0, 1, 0,
0, 1, 0, 1,
1, 0, 1, 0
},
{ //35
0, 0, 1, 1,
0, 0, 1, 1,
1, 1, 0, 0,
1, 1, 0, 0
},
{ //36
0, 0, 1, 1,
1, 1, 0, 0,
0, 0, 1, 1,
1, 1, 0, 0
},
{ //37
0, 1, 0, 1,
0, 1, 0, 1,
1, 0, 1, 0,
1, 0, 1, 0
},
{ //38
0, 1, 1, 0,
1, 0, 0, 1,
0, 1, 1, 0,
1, 0, 0, 1
},
{ //39
0, 1, 0, 1,
1, 0, 1, 0,
1, 0, 1, 0,
0, 1, 0, 1
},
{ //40
0, 1, 1, 1,
0, 0, 1, 1,
1, 1, 0, 0,
1, 1, 1, 0
},
{ //41
0, 0, 0, 1,
0, 0, 1, 1,
1, 1, 0, 0,
1, 0, 0, 0
},
{ //42
0, 0, 1, 1,
0, 0, 1, 0,
0, 1, 0, 0,
1, 1, 0, 0
},
{ //43
0, 0, 1, 1,
1, 0, 1, 1,
1, 1, 0, 1,
1, 1, 0, 0
},
{ //44
0, 1, 1, 0,
1, 0, 0, 1,
1, 0, 0, 1,
0, 1, 1, 0
},
{ //45
0, 0, 1, 1,
1, 1, 0, 0,
1, 1, 0, 0,
0, 0, 1, 1
},
{ //46
0, 1, 1, 0,
0, 1, 1, 0,
1, 0, 0, 1,
1, 0, 0, 1
},
{ //47
0, 0, 0, 0,
0, 1, 1, 0,
0, 1, 1, 0,
0, 0, 0, 0
},
{ //48
0, 1, 0, 0,
1, 1, 1, 0,
0, 1, 0, 0,
0, 0, 0, 0
},
{ //49
0, 0, 1, 0,
0, 1, 1, 1,
0, 0, 1, 0,
0, 0, 0, 0
},
{ //50
0, 0, 0, 0,
0, 0, 1, 0,
0, 1, 1, 1,
0, 0, 1, 0
},
{ //51
0, 0, 0, 0,
0, 1, 0, 0,
1, 1, 1, 0,
0, 1, 0, 0
},
{ //52
0, 1, 1, 0,
1, 1, 0, 0,
1, 0, 0, 1,
0, 0, 1, 1
},
{ //53
0, 0, 1, 1,
0, 1, 1, 0,
1, 1, 0, 0,
1, 0, 0, 1
},
{ //54
0, 1, 1, 0,
0, 0, 1, 1,
1, 0, 0, 1,
1, 1, 0, 0
},
{ //55
0, 0, 1, 1,
1, 0, 0, 1,
1, 1, 0, 0,
0, 1, 1, 0
},
{ //56
0, 1, 1, 0,
1, 1, 0, 0,
1, 1, 0, 0,
1, 0, 0, 1
},
{ //57
0, 1, 1, 0,
0, 0, 1, 1,
0, 0, 1, 1,
1, 0, 0, 1
},
{ //58
0, 1, 1, 1,
1, 1, 1, 0,
1, 0, 0, 0,
0, 0, 0, 1
},
{ //59
0, 0, 0, 1,
1, 0, 0, 0,
1, 1, 1, 0,
0, 1, 1, 1
},
{ //60
0, 0, 0, 0,
1, 1, 1, 1,
0, 0, 1, 1,
0, 0, 1, 1
},
{ //61
0, 0, 1, 1,
0, 0, 1, 1,
1, 1, 1, 1,
0, 0, 0, 0
},
{ //62
0, 0, 1, 0,
0, 0, 1, 0,
1, 1, 1, 0,
1, 1, 1, 0
},
{ //63
0, 1, 0, 0,
0, 1, 0, 0,
0, 1, 1, 1,
0, 1, 1, 1
}
};

const BC7PartitionTable bc7PartitionTable3Subsets[64]{
{ //0
0, 0, 1, 1,
0, 0, 1, 1,
0, 2, 2, 1,
2, 2, 2, 2
},
{ //1
0, 0, 0, 1,
0, 0, 1, 1,
2, 2, 1, 1,
2, 2, 2, 1
},
{ //2
0, 0, 0, 0,
2, 0, 0, 1,
2, 2, 1, 1,
2, 2, 1, 1
},
{ //3
0, 2, 2, 2,
0, 0, 2, 2,
0, 0, 1, 1,
0, 1, 1, 1
},
{ //4
0, 0, 0, 0,
0, 0, 0, 0,
1, 1, 2, 2,
1, 1, 2, 2
},
{ //5
0, 0, 1, 1,
0, 0, 1, 1,
0, 0, 2, 2,
0, 0, 2, 2
},
{ //6
0, 0, 2, 2,
0, 0, 2, 2,
1, 1, 1, 1,
1, 1, 1, 1
},
{ //7
0, 0, 1, 1,
0, 0, 1, 1,
2, 2, 1, 1,
2, 2, 1, 1
},
{ //8
0, 0, 0, 0,
0, 0, 0, 0,
1, 1, 1, 1,
2, 2, 2, 2
},
{ //9
0, 0, 0, 0,
1, 1, 1, 1,
1, 1, 1, 1,
2, 2, 2, 2
},
{ //10
0, 0, 0, 0,
1, 1, 1, 1,
2, 2, 2, 2,
2, 2, 2, 2
},
{ //11
0, 0, 1, 2,
0, 0, 1, 2,
0, 0, 1, 2,
0, 0, 1, 2
},
{ //12
0, 1, 1, 2,
0, 1, 1, 2,
0, 1, 1, 2,
0, 1, 1, 2
},
{ //13
0, 1, 2, 2,
0, 1, 2, 2,
0, 1, 2, 2,
0, 1, 2, 2
},
{ //14
0, 0, 1, 1,
0, 1, 1, 2,
1, 1, 2, 2,
1, 2, 2, 2
},
{ //15
0, 0, 1, 1,
2, 0, 0, 1,
2, 2, 0, 0,
2, 2, 2, 0
},
{ //16
0, 0, 0, 1,
0, 0, 1, 1,
0, 1, 1, 2,
1, 1, 2, 2
},
{ //17
0, 1, 1, 1,
0, 0, 1, 1,
2, 0, 0, 1,
2, 2, 0, 0
},
{ //18
0, 0, 0, 0,
1, 1, 2, 2,
1, 1, 2, 2,
1, 1, 2, 2
},
{ //19
0, 0, 2, 2,
0, 0, 2, 2,
0, 0, 2, 2,
1, 1, 1, 1
},
{ //20
0, 1, 1, 1,
0, 1, 1, 1,
0, 2, 2, 2,
0, 2, 2, 2
},
{ //21
0, 0, 0, 1,
0, 0, 0, 1,
2, 2, 2, 1,
2, 2, 2, 1
},
{ //22
0, 0, 0, 0,
0, 0, 1, 1,
0, 1, 2, 2,
0, 1, 2, 2
},
{ //23
0, 0, 0, 0,
1, 1, 0, 0,
2, 2, 1, 0,
2, 2, 1, 0
},
{ //24
0, 1, 2, 2,
0, 1, 2, 2,
0, 0, 1, 1,
0, 0, 0, 0
},
{ //25
0, 0, 1, 2,
0, 0, 1, 2,
1, 1, 2, 2,
2, 2, 2, 2
},
{ //26
0, 1, 1, 0,
1, 2, 2, 1,
1, 2, 2, 1,
0, 1, 1, 0
},
{ //27
0, 0, 0, 0,
0, 1, 1, 0,
1, 2, 2, 1,
1, 2, 2, 1
},
{ //28
0, 0, 2, 2,
1, 1, 0, 2,
1, 1, 0, 2,
0, 0, 2, 2
},
{ //29
0, 1, 1, 0,
0, 1, 1, 0,
2, 0, 0, 2,
2, 2, 2, 2
},
{ //30
0, 0, 1, 1,
0, 1, 2, 2,
0, 1, 2, 2,
0, 0, 1, 1
},
{ //31
0, 0, 0, 0,
2, 0, 0, 0,
2, 2, 1, 1,
2, 2, 2, 1
},
{ //32
0, 0, 0, 0,
0, 0, 0, 2,
1, 1, 2, 2,
1, 2, 2, 2
},
{ //33
0, 2, 2, 2,
0, 0, 2, 2,
0, 0, 1, 2,
0, 0, 1, 1
},
{ //34
0, 0, 1, 1,
0, 0, 1, 2,
0, 0, 2, 2,
0, 2, 2, 2
},
{ //35
0, 1, 2, 0,
0, 1, 2, 0,
0, 1, 2, 0,
0, 1, 2, 0
},
{ //36
0, 0, 0, 0,
1, 1, 1, 1,
2, 2, 2, 2,
0, 0, 0, 0
},
{ //37
0, 1, 2, 0,
1, 2, 0, 1,
2, 0, 1, 2,
0, 1, 2, 0
},
{ //38
0, 1, 2, 0,
2, 0, 1, 2,
1, 2, 0, 1,
0, 1, 2, 0
},
{ //39
0, 0, 1, 1,
2, 2, 0, 0,
1, 1, 2, 2,
0, 0, 1, 1
},
{ //40
0, 0, 1, 1,
1, 1, 2, 2,
2, 2, 0, 0,
0, 0, 1, 1
},
{ //41
0, 1, 0, 1,
0, 1, 0, 1,
2, 2, 2, 2,
2, 2, 2, 2
},
{ //42
0, 0, 0, 0,
0, 0, 0, 0,
2, 1, 2, 1,
2, 1, 2, 1
},
{ //43
0, 0, 2, 2,
1, 1, 2, 2,
0, 0, 2, 2,
1, 1, 2, 2
},
{ //44
0, 0, 2, 2,
0, 0, 1, 1,
0, 0, 2, 2,
0, 0, 1, 1
},
{ //45
0, 2, 2, 0,
1, 2, 2, 1,
0, 2, 2, 0,
1, 2, 2, 1
},
{ //46
0, 1, 0, 1,
2, 2, 2, 2,
2, 2, 2, 2,
0, 1, 0, 1
},
{ //47
0, 0, 0, 0,
2, 1, 2, 1,
2, 1, 2, 1,
2, 1, 2, 1
},
{ //48
0, 1, 0, 1,
0, 1, 0, 1,
0, 1, 0, 1,
2, 2, 2, 2
},
{ //49
0, 2, 2, 2,
0, 1, 1, 1,
0, 2, 2, 2,
0, 1, 1, 1
},
{ //50
0, 0, 0, 2,
1, 1, 1, 2,
0, 0, 0, 2,
1, 1, 1, 2
},
{ //51
0, 0, 0, 0,
2, 1, 1, 2,
2, 1, 1, 2,
2, 1, 1, 2
},
{ //52
0, 2, 2, 2,
0, 1, 1, 1,
0, 1, 1, 1,
0, 2, 2, 2
},
{ //53
0, 0, 0, 2,
1, 1, 1, 2,
1, 1, 1, 2,
0, 0, 0, 2
},
{ //54
0, 1, 1, 0,
0, 1, 1, 0,
0, 1, 1, 0,
2, 2, 2, 2
},
{ //55
0, 0, 0, 0,
0, 0, 0, 0,
2, 1, 1, 2,
2, 1, 1, 2
},
{ //56
0, 1, 1, 0,
0, 1, 1, 0,
2, 2, 2, 2,
2, 2, 2, 2
},
{ //57
0, 0, 2, 2,
0, 0, 1, 1,
0, 0, 1, 1,
0, 0, 2, 2
},
{ //58
0, 0, 2, 2,
1, 1, 2, 2,
1, 1, 2, 2,
0, 0, 2, 2
},
{ //59
0, 0, 0, 0,
0, 0, 0, 0,
0, 0, 0, 0,
2, 1, 1, 2
},
{ //60
0, 0, 0, 2,
0, 0, 0, 1,
0, 0, 0, 2,
0, 0, 0, 1
},
{ //61
0, 2, 2, 2,
1, 2, 2, 2,
0, 2, 2, 2,
1, 2, 2, 2
},
{ //62
0, 1, 0, 1,
2, 2, 2, 2,
2, 2, 2, 2,
2, 2, 2, 2
},
{ //63
0, 1, 1, 1,
2, 0, 1, 1,
2, 2, 0, 1,
2, 2, 2, 0
}
};

void print_bc7_partition_table(const BC7PartitionTable subsets[64]) {
	for (uint32_t i = 0; i < 64; i++) {
		const BC7PartitionTable& table = subsets[i];
		for (uint32_t i = 0; i < 4; i++) {
			std::cout << static_cast<uint32_t>(table.partitionNumbers[i * 4 + 0]) << " ";
			std::cout << static_cast<uint32_t>(table.partitionNumbers[i * 4 + 1]) << " ";
			std::cout << static_cast<uint32_t>(table.partitionNumbers[i * 4 + 2]) << " ";
			std::cout << static_cast<uint32_t>(table.partitionNumbers[i * 4 + 3]) << '\n';
		}
		std::cout << '\n';
	}
}

void print_bc7_tables() {
	print_bc7_partition_table(bc7PartitionTable2Subsets);
	print_bc7_partition_table(bc7PartitionTable3Subsets);
}